<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Getting started | DataMesh Fusion API</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://datameshgroup.github.io/fusion/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://datameshgroup.github.io/fusion/img/logo.png"><meta data-rh="true" property="og:url" content="https://datameshgroup.github.io/fusion/docs/getting-started"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Getting started | DataMesh Fusion API"><meta data-rh="true" name="description" content="- Sale System - point of sale application"><meta data-rh="true" property="og:description" content="- Sale System - point of sale application"><link data-rh="true" rel="icon" href="/fusion/img/logo.png"><link data-rh="true" rel="canonical" href="https://datameshgroup.github.io/fusion/docs/getting-started"><link data-rh="true" rel="alternate" href="https://datameshgroup.github.io/fusion/docs/getting-started" hreflang="en"><link data-rh="true" rel="alternate" href="https://datameshgroup.github.io/fusion/docs/getting-started" hreflang="x-default"><link rel="stylesheet" href="/fusion/assets/css/styles.427cef24.css">
<script src="/fusion/assets/js/runtime~main.9bd8fe5b.js" defer="defer"></script>
<script src="/fusion/assets/js/main.ffc2ab6b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fusion/"><div class="navbar__logo"><img src="/fusion/img/logo.png" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/fusion/img/logo.png" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">DataMesh Group</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fusion/docs/getting-started">Fusion API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/datameshgroup" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/fusion/docs/getting-started">Getting started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/fusion/docs/category/api-reference">API Reference</a><button aria-label="Expand sidebar category &#x27;API Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fusion/docs/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fusion/docs/production">Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fusion/docs/appendix">Appendix</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/fusion/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Getting started</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Getting started</h1>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li><em>Sale System</em> - point of sale application</li>
<li><em>POI Terminal</em> - the DataMesh payments terminal (PINpad)</li>
</ul></div></div>
<p>The steps outlined below will guide you through creating a dev account, scoping your Sale System requirements based on the DataMesh functionality, coding and testing your integration, getting accredited with DataMesh, and finally deploying your solution into production.</p>
<ol>
<li><a href="/fusion/docs/getting-started#create-a-test-account">Create a test account</a></li>
<li><a href="/fusion/docs/getting-started#determine-your-integration-type">Determine your integration type</a></li>
<li><a href="/fusion/docs/getting-started#design-your-integration">Design your integration</a></li>
<li><a href="/fusion/docs/category/api-reference">Code your POS integration</a></li>
<li><a href="/fusion/docs/testing">POS accreditation</a></li>
<li><a href="/fusion/docs/production">Production deployment</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-test-account">Create a test account<a class="hash-link" aria-label="Direct link to Create a test account" title="Direct link to Create a test account" href="/fusion/docs/getting-started#create-a-test-account">​</a></h2>
<p>All DataMesh integrations require a physical DataMesh terminal. Depending on the <a href="/fusion/docs/getting-started#determine-your-integration-type">integration type</a> DataMesh may also need to allocate Sale System credentials.</p>
<p>When requesting a development terminal and account, let us know:</p>
<ul>
<li>Which integration type(s) you plan on working with</li>
<li>If you plan of supporting multiple Sale Systems connected to the same terminal, or multiple terminals connected to one Sale System.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You can request a terminal and a development account via <a href="mailto:integrations@datameshgroup.com" target="_blank" rel="noopener noreferrer">integrations@datameshgroup.com</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="determine-your-integration-type">Determine your integration type<a class="hash-link" aria-label="Direct link to Determine your integration type" title="Direct link to Determine your integration type" href="/fusion/docs/getting-started#determine-your-integration-type">​</a></h2>
<p>DataMesh provides a variety of options to help you design your integration depending on your Sale System type.</p>
<table><thead><tr><th>Sale System Type</th><th style="text-align:center">Fusion App</th><th style="text-align:center">Fusion Satellite</th><th style="text-align:center">Fusion Cloud</th></tr></thead><tbody><tr><td>Windows-based POS where it&#x27;s possible to install the DataMesh middleware<br>on the same PC where the POS application is running on</td><td style="text-align:center">✔</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td>POS on Pinpad/POI Terminal</td><td style="text-align:center"></td><td style="text-align:center">✔</td><td style="text-align:center"></td></tr><tr><td>Other POS type including Legacy POS/On-Premises POS/Traditional POS and POS on Mobile (iOS/Android) device</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">✔</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-app"><a href="/fusion/docs/api-reference/fusion-app">Fusion App</a><a class="hash-link" aria-label="Direct link to fusion-app" title="Direct link to fusion-app" href="/fusion/docs/getting-started#fusion-app">​</a></h3>
<p>Fusion App is a DataMesh middleware that is installed in the PC as the Sale System.</p>
<p>Fusion App wraps the Fusion Cloud API and handles many of the interactions between the Sale System and the POI terminal (web socket, security, pairing, error handling, UI etc).</p>
<p>There are two ways on how the Fusion App communicates with the POI terminal:</p>
<ul>
<li>Cloud - Fusion App communicates with the POI terminal via a Websocket connected to the DataMesh Unify switch.</li>
</ul>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/POS-fusion-app-8c9ac02ff4da2dd2e03c641134506b86.png" width="379" height="429" class="img_ev3q"></p>
<ul>
<li>USB Connection<!-- -->
<ul>
<li>Base USB Connection - Fusion App communicates with the POI terminal through a USB cable connected to the POI terminal’s Base/Dock device.  The POI terminal must be paired with its Base/Dock device.</li>
<li>Terminal USB Connection - Fusion App communicates with the POI terminal through a USB cable connected directly to the POI terminal.</li>
</ul>
</li>
</ul>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/POS-fusion-app-usb-4d6bb393a07de39cb1adf9fde7b4c889.png" width="379" height="425" class="img_ev3q"></p>
<p>There are two methods for processing a payment using Fusion App:</p>
<ul>
<li>Events mode - the Sale System sends a HTTP POST to a local endpoint, and if valid receives 202 ACCEPTED. The Sale System polls Fusion App, processing events received until the payment response is returned.</li>
<li>Blocking - the Sale System sends a HTTP POST to a local endpoint, and waits for a response. If successful (200 OK) the response will contain the payment response details.</li>
</ul>
<p>In both methods, in case of an error (timeout, system crash etc), the Sale System sends a HTTP GET request to request the status of the payment.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Where possible, DataMesh recommends implementing events mode.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-app-payment-lifecycle-events-mode">Fusion App payment lifecycle (events mode)<a class="hash-link" aria-label="Direct link to Fusion App payment lifecycle (events mode)" title="Direct link to Fusion App payment lifecycle (events mode)" href="/fusion/docs/getting-started#fusion-app-payment-lifecycle-events-mode">​</a></h4>
<ol>
<li>Merchant launches the Sale System.</li>
<li>Merchant initiates a payment.</li>
<li>Sale system generates a unique <code>SessionID</code> as a UUIDv4 and constructs a <a href="/fusion/docs/api-reference/data-model#payment-request">payment request</a> object.</li>
<li>Sale System POSTs the <a href="/fusion/docs/api-reference/data-model#payment-request">payment request</a> for the <code>SessionID</code> to Fusion App&#x27;s local HTTP end point for payments and waits for a response.</li>
<li>If the request is valid, Fusion App will respond with 202 ACCEPTED and start processing the payment.</li>
<li>Sale System GETs and processes each event until a PaymentResponse is received</li>
<li>Merchant closes the Sale System.<!-- -->
<ul>
<li>If the Sale System doesn&#x27;t receive a payment response (timeout, system crash etc) from Fusion App it needs to enter error handling by calling (GET /payments/{{<em>SessionId</em>}})</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-lifecycle-fusion-app-events-ef115d81eb526710eb72d3175a297db5.png" width="1269" height="1435" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-app-payment-lifecycle-blocking-mode">Fusion App payment lifecycle (blocking mode)<a class="hash-link" aria-label="Direct link to Fusion App payment lifecycle (blocking mode)" title="Direct link to Fusion App payment lifecycle (blocking mode)" href="/fusion/docs/getting-started#fusion-app-payment-lifecycle-blocking-mode">​</a></h4>
<ol>
<li>Merchant launches the Sale System.</li>
<li>Merchant initiates a payment.</li>
<li>Sale system generates a unique <code>SessionID</code> as a UUIDv4 and constructs a <a href="/fusion/docs/api-reference/data-model#payment-request">payment request</a> object.</li>
<li>Sale System POSTs the <a href="/fusion/docs/api-reference/data-model#payment-request">payment request</a> for the <code>SessionID</code> to Fusion App&#x27;s local HTTP end point for payments and waits for a response.</li>
<li>Fusion App does all the necessary payment processing.</li>
<li>Sale System receives a payment response.</li>
<li>Merchant closes the Sale System.<!-- -->
<ul>
<li>If the Sale System doesn&#x27;t receive a payment response (timeout, system crash etc) from Fusion App it needs to enter error handling by calling (GET /payments/{{<em>SessionId</em>}})</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-lifecycle-fusion-app-372543e06845ce00a88bcbcb1623200e.png" width="943" height="1246" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-satellite"><a href="/fusion/docs/api-reference/fusion-satellite">Fusion Satellite</a><a class="hash-link" aria-label="Direct link to fusion-satellite" title="Direct link to fusion-satellite" href="/fusion/docs/getting-started#fusion-satellite">​</a></h3>
<p>The Fusion Satellite API allows a Sale System running on the POI terminal to communicate with the DataMesh Satellite payment application on the same POI terminal using inter-app communication with <a href="https://developer.android.com/guide/components/intents-filters" target="_blank" rel="noopener noreferrer">Android intents</a>.</p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/POS-fusion-satellite-0dfe0da7543b14c851e9113bea913796.png" width="379" height="429" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-satellite-payment-lifecycle">Fusion Satellite payment lifecycle<a class="hash-link" aria-label="Direct link to Fusion Satellite payment lifecycle" title="Direct link to Fusion Satellite payment lifecycle" href="/fusion/docs/getting-started#fusion-satellite-payment-lifecycle">​</a></h4>
<ol>
<li>Merchant launches the Sale System on the POI Terminal.</li>
<li>Merchant initiates a payment.</li>
<li>Sale system constructs a <a href="/fusion/docs/api-reference/data-model#payment-request">payment request</a> object.</li>
<li>Sale System calls Satellite via startActivityForResult() and waits for a response.</li>
<li>Satellite does all the necessary payment processing.</li>
<li>Sale System receives a payment response.</li>
<li>Merchant closes the Sale System.</li>
</ol>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-lifecycle-fusion-satellite-14d98cb87f823ad2b44d60f686172c96.png" width="650" height="563" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-cloud"><a href="/fusion/docs/api-reference/fusion-cloud">Fusion Cloud</a><a class="hash-link" aria-label="Direct link to fusion-cloud" title="Direct link to fusion-cloud" href="/fusion/docs/getting-started#fusion-cloud">​</a></h3>
<p>The Fusion Cloud API allows the Sale System to communicate with a POI terminal via a Websocket connected to the DataMesh Unify switch.</p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/POS-fusion-cloud-mobile-0d0e83446ba15e6bd873dbce72b47fae.png" width="379" height="429" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fusion-cloud-payment-lifecycle">Fusion Cloud payment lifecycle<a class="hash-link" aria-label="Direct link to Fusion Cloud payment lifecycle" title="Direct link to Fusion Cloud payment lifecycle" href="/fusion/docs/getting-started#fusion-cloud-payment-lifecycle">​</a></h4>
<ol>
<li>Merchant launches the Sale System.</li>
<li>Sale System opens the websocket connection.</li>
<li>Sale System has the option to link with a POI Terminal by performing a <a href="/fusion/docs/api-reference/fusion-cloud#login-request">login request</a> either:</li>
<li>When the Sale System launches or</li>
<li>Before the first payment request is sent</li>
<li>Sale System receives a successful login response.</li>
<li>Merchant initiates a payment.</li>
<li>Sale System sets txn_in_progress flag in local persistent storage. (This is will be used for <a href="/fusion/docs/api-reference/fusion-cloud#error-handling">error handling</a>.)</li>
<li>Sale System sends a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment request</a>.</li>
<li>Sale System saves message reference details in local persistent storage.  (This is will be used for <a href="/fusion/docs/api-reference/fusion-cloud#error-handling">error handling</a>.)</li>
<li>Sale System handles <a href="/fusion/docs/api-reference/fusion-cloud#display">display requests</a>, <a href="/fusion/docs/api-reference/fusion-cloud#print">print requests</a>, and <a href="/fusion/docs/api-reference/fusion-cloud#input">input requests</a></li>
<li>Sale System receives a payment response.</li>
<li>Sale System clears the message reference details in the local persistent storage.</li>
<li>Sale System clears the txn_in_progress flag in the local persistent storage.</li>
<li>Merchant closes the Sale System.</li>
<li>Sale System can optionally send a <a href="/fusion/docs/api-reference/fusion-cloud#logout">logout request</a>.</li>
<li>Sale System closes the websocket.</li>
</ol>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-lifecycle-fusion-cloud-fbcfd77ac1956c20c9a8ae96b4aed783.png" width="893" height="1507" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mandatory-features-checklist">Mandatory features checklist<a class="hash-link" aria-label="Direct link to Mandatory features checklist" title="Direct link to Mandatory features checklist" href="/fusion/docs/getting-started#mandatory-features-checklist">​</a></h3>
<p>The table below provides an overview of the mandatory integration requirements which are required for your selected integration type.</p>
<table><thead><tr><th>Integration Requirement</th><th style="text-align:center">Fusion App</th><th style="text-align:center">Fusion Satellite</th><th style="text-align:center">Fusion Cloud</th></tr></thead><tbody><tr><td>Implement the payment lifecycle (<a href="/fusion/docs/getting-started#fusion-app-payment-lifecycle-events-mode">Fusion App</a>, <a href="/fusion/docs/getting-started#fusion-satellite-payment-lifecycle">Fusion Satellite</a>, <a href="/fusion/docs/getting-started#fusion-cloud-payment-lifecycle">Fusion Cloud</a>)</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr><tr><td>Support for <em>purchase</em> and <em>refund</em> <a href="/fusion/docs/getting-started#payment-types">payment types</a></td><td style="text-align:center">✔</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr><tr><td>Support for <a href="/fusion/docs/api-reference/fusion-api-fuel-extension">Fusion Fuel API</a> (for Sale Systems which support fuel payments)</td><td style="text-align:center">✔</td><td style="text-align:center"></td><td style="text-align:center">✔</td></tr><tr><td>Support for <a href="/fusion/docs/api-reference/fusion-api-stored-value-extension">Fusion Stored Value API</a></td><td style="text-align:center">✔</td><td style="text-align:center"></td><td style="text-align:center">✔</td></tr><tr><td>Include <a href="/fusion/docs/getting-started#product-data">product data</a> in each payment request</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr><tr><td>Support for TLS and other <a href="/fusion/docs/api-reference/fusion-cloud#security-requirements">security requirements</a></td><td style="text-align:center"></td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr><tr><td>Additional fields will be added to the message specification over time.<br>To ensure forwards compatibility the Sale System must ignore when extra objects and fields are present in response messages.<br>This includes valid MAC handling in the SecurityTrailer.</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">✔</td></tr><tr><td>Implement <a href="/fusion/docs/getting-started#sale-system-settings">Sale System settings</a> requirements</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">✔</td></tr><tr><td>Implement <a href="/fusion/docs/getting-started#payment-user-interface">Payments user interface</a> which handles the <code>Initial UI</code>, <code>Final UI</code>, <code>Display UI</code>, and <code>Cancelling a Sale in Progress</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">✔</td></tr><tr><td>Handle error scenarios as outlined in <a href="/fusion/docs/getting-started#error-handling">error handling</a></td><td style="text-align:center"></td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr><tr><td>Ensure Sale System provides a unique <a href="/fusion/docs/getting-started#payment-identification">payment identification</a></td><td style="text-align:center">✔</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr><tr><td>Pass the accreditation <a href="/fusion/docs/testing">test script</a></td><td style="text-align:center">✔</td><td style="text-align:center">✔</td><td style="text-align:center">✔</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-your-integration">Design your integration<a class="hash-link" aria-label="Direct link to Design your integration" title="Direct link to Design your integration" href="/fusion/docs/getting-started#design-your-integration">​</a></h2>
<p>Before development commences, you should familiarise yourself with the DataMesh payment platform, including the mandatory and optional features available.</p>
<p>This will enable you to scope the development work required to complete the DataMesh integration with your Sale System.</p>
<p>You should refer to the accreditation <a href="/fusion/docs/testing">test script</a> as a guide to ensure that the Sale System has successfully implemented the mandatory integration requirements for your integration type.</p>
<p>The list of mandatory requirements are listed in the <a href="/fusion/docs/getting-started#mandatory-features-checklist">Mandatory Features Checklist</a> section.</p>
<p>Depending on your Sale System design, other features may be required.</p>
<p><strong>Other features available</strong></p>
<ul>
<li>Sale System <a href="/fusion/docs/getting-started#receipt-printing">receipt printing</a></li>
<li>Payments <a href="/fusion/docs/getting-started#payment-user-interface">user interface</a> for all displays and inputs</li>
<li><a href="/fusion/docs/getting-started#cash-out">Cash out</a></li>
<li><a href="/fusion/docs/getting-started#settlement">Settlement</a></li>
<li><a href="/fusion/docs/getting-started#tokenisation">Tokenisation</a></li>
<li><a href="/fusion/docs/getting-started#tipping">Tipping</a></li>
<li><a href="/fusion/docs/getting-started#dynamic-surcharge">Dynamic surcharge</a></li>
<li><a href="/fusion/docs/getting-started#pre-auth-completion">Pre-authorisation / completion</a></li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>For help on scoping your development work, or to discuss integration requirements, please contact the DataMesh integrations team at <a href="mailto:integrations@datameshgroup.com"><a href="mailto:integrations@datameshgroup.com" target="_blank" rel="noopener noreferrer">integrations@datameshgroup.com</a></a></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sale-system-settings">Sale System settings<a class="hash-link" aria-label="Direct link to Sale System settings" title="Direct link to Sale System settings" href="/fusion/docs/getting-started#sale-system-settings">​</a></h3>
<div class="theme-admonition theme-admonition-success admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>success</div><div class="admonitionContent_BuS1"><p>Sale System settings are only required for the <a href="/fusion/docs/getting-started#fusion-cloud">Fusion Cloud</a> integration type. If you are using <strong>Fusion App</strong> or <strong>Fusion Satellite</strong> you can skip this section.</p></div></div>
<p>The Sale System must support configuration of settings to identify the Sale System to DataMesh, and to pair a POI Terminal to a Sale System.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="static-sale-system-settings">Static Sale System settings<a class="hash-link" aria-label="Direct link to Static Sale System settings" title="Direct link to Static Sale System settings" href="/fusion/docs/getting-started#static-sale-system-settings">​</a></h4>
<p>Static Sale System settings are provided by DataMesh and are linked to the build of the Sale System. i.e. they will be the same for all merchants using the Sale System build.</p>
<p>These settings can be contained in a database or configuration file editable by a Sale System engineer, or hard coded into the Sale System build.</p>
<p>Regardless of where they are stored, the Sale System must ensure the cashier or merchant is never required to configure the static settings, as they will not be aware of the required values.</p>
<p>DataMesh will provide two sets of static settings; one set for the test environment, and one set for production. It is the responsibility of the Sale System to ensure the correct values
are included in a test or production build.</p>
<p>The static Sale System settings are</p>
<table><thead><tr><th>Attribute</th><th>Requ.</th><th>Format</th><th>Description</th></tr></thead><tbody><tr><td><a href="/fusion/docs/api-reference/data-model#provideridentification">ProviderIdentification</a></td><td>✔</td><td>String</td><td>The name of the company supplying the Sale System. Provided by DataMesh. Sent in the login request.</td></tr><tr><td><a href="/fusion/docs/api-reference/data-model#applicationname">ApplicationName</a></td><td>✔</td><td>String</td><td>The name of the Sale System application. Provided by DataMesh. Sent in the login request.</td></tr><tr><td><a href="/fusion/docs/api-reference/data-model#softwareversion">SoftwareVersion</a></td><td>✔</td><td>String</td><td>Must indicate the software version of the current Sale System build. Sent in the login request.</td></tr><tr><td><a href="/fusion/docs/api-reference/data-model#certificationcode">CertificationCode</a></td><td>✔</td><td>String</td><td>Certification code for this Sale System. Provided by DataMesh. Sent in the login request.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cashier-configurable-settings">Cashier configurable settings<a class="hash-link" aria-label="Direct link to Cashier configurable settings" title="Direct link to Cashier configurable settings" href="/fusion/docs/getting-started#cashier-configurable-settings">​</a></h4>
<p>The <a href="/fusion/docs/api-reference/data-model#saleid">SaleID</a>, <a href="/fusion/docs/api-reference/data-model#kek">KEK</a>, and <a href="/fusion/docs/api-reference/data-model#poiid">POIID</a> are cashier configurable settings which may be different for each lane. These fields authenticate a Sale System, and pair a Sale System to a POI terminal.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>DataMesh offers <strong><a href="/fusion/docs/getting-started#qr-code-pairing">QR code pairing</a></strong> to simplify entry of the SaleID, POIID, and KEK. The Sale System should still support manual entry of the SaleID, POIID, and KEK as a fallback for when QR POS pairing is not possible.</p></div></div>
<p>The Sale System must ensure there is a user interface accessible by the cashier which enables these settings to be configured.</p>
<p>The <a href="/fusion/docs/api-reference/data-model#saleid">SaleID</a> and <a href="/fusion/docs/api-reference/data-model#poiid">POIID</a> should be visible to the cashier. The <a href="/fusion/docs/api-reference/data-model#kek">KEK</a> should be masked after entry by the cashier.</p>
<p>If the Sale System is to support many-to-one configuration (i.e. one Sale System linked to many POI terminals) it should support the entry of <a href="/fusion/docs/api-reference/data-model#saleid">SaleID</a> and <a href="/fusion/docs/api-reference/data-model#kek">KEK</a> to identify the  Sale System lane, and a <a href="/fusion/docs/api-reference/data-model#poiid">POIID</a> for each POI terminal linked.</p>
<p><em>Example setting UI</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/settings-ui-8a7de2eade06596a015d8867dadce214.png" width="601" height="441" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="qr-code-pairing">QR code pairing<a class="hash-link" aria-label="Direct link to QR code pairing" title="Direct link to QR code pairing" href="/fusion/docs/getting-started#qr-code-pairing">​</a></h4>
<p><strong>QR code pairing</strong> enables configuration of the configurable settings (i.e. SaleID, POIID, and KEK) without requiring manual entry by the cashier.</p>
<p>How this works:</p>
<ol>
<li>Sale System generates a pairing QR code which contains pairing credentials, and displays it on the Sale System screen.</li>
<li>The QR code is scanned by the POI Terminal.</li>
<li>The Sale System sends a pairing login request and saves the POIID returned by DataMesh, along with the SaleID and KEK generated by the POS.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Sale System settings are only required for the Fusion Cloud integration type.</p><p>Fusion App already supports <strong>QR code pairing</strong> out-of-the-box.</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---generate-a-pairing-qr-code">Step 1 - generate a pairing QR code<a class="hash-link" aria-label="Direct link to Step 1 - generate a pairing QR code" title="Direct link to Step 1 - generate a pairing QR code" href="/fusion/docs/getting-started#step-1---generate-a-pairing-qr-code">​</a></h5>
<p>The pairing QR code:</p>
<ul>
<li>will represent the pairing data JSON.</li>
<li>will be version 8 binary format (max length: 152) with Medium ECC.</li>
</ul>
<p>To minimise the size of the data in the QR code, a abbreviated JSON fields format is used.</p>
<table><thead><tr><th>JSON property</th><th>Name</th><th>Format</th></tr></thead><tbody><tr><td>s</td><td><a href="/fusion/docs/api-reference/data-model#saleid">SaleID</a></td><td>String. Random UUID v4. 8-4-4-4-12 format.</td></tr><tr><td>p</td><td>PairingPOIIDString.</td><td>String. Random UUID v4. 8-4-4-4-12 format.</td></tr><tr><td>k</td><td><a href="/fusion/docs/api-reference/data-model#kek">KEK</a></td><td>String. Random. 48-character string populated with characters 0-9, and A-F. Please refer to the <a href="/fusion/docs/getting-started#sample-kek-generation">sample KEK generation</a></td></tr><tr><td>c</td><td><a href="/fusion/docs/api-reference/data-model#certificationcode">CertificationCode</a></td><td>String. Certification code provided by DataMesh.</td></tr><tr><td>n</td><td>POSName</td><td>String. POS display name with at most 30 characters. This can be the Work Station name or any name that you prefer. Name displayed on the report and on the Satellite app (e.g. during a POS payment transaction).</td></tr><tr><td>v</td><td>Version</td><td>Numeric. Pairing version code. Set to 1.</td></tr></tbody></table>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="sample-pairing-qr-code-data">Sample Pairing QR Code Data<a class="hash-link" aria-label="Direct link to Sample Pairing QR Code Data" title="Direct link to Sample Pairing QR Code Data" href="/fusion/docs/getting-started#sample-pairing-qr-code-data">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;s&quot;: &quot;09c04710-265f-4094-88ee-a981794127f8&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;p&quot;: &quot;a2381e7c-1303-44de-ac3b-5fe68a0d973d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;k&quot;: &quot;86BB447CE6D1C56E33C2717BE03EED579B2EAB7EC9465817&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;c&quot;: *replace with data provided by DataMesh*,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;n&quot;: &quot;WorkStation 001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;v&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="sample-kek-generation">Sample KEK Generation<a class="hash-link" aria-label="Direct link to Sample KEK Generation" title="Direct link to Sample KEK Generation" href="/fusion/docs/getting-started#sample-kek-generation">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">string chars = &quot;0123456789ABCDEF&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string result = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Random random = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (int i = 0; i &lt; 48; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  result += chars[random.Next(chars.Length)];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine(&quot;KEK = &quot; + result); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//Sample output </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEK = 86BB447CE6D1C56E33C2717BE03EED579B2EAB7EC9465817</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="reference-code">Reference code<a class="hash-link" aria-label="Direct link to Reference code" title="Direct link to Reference code" href="/fusion/docs/getting-started#reference-code">​</a></h5>
<table><thead><tr><th style="text-align:center">Development Language</th><th>Description</th><th>Location</th></tr></thead><tbody><tr><td style="text-align:center">.Net</td><td>.Net NuGet package</td><td>on <a href="https://www.nuget.org/packages/DataMeshGroup.Fusion.Pairing.WinForms" target="_blank" rel="noopener noreferrer">Nuget</a></td></tr><tr><td style="text-align:center"></td><td>Source Code</td><td>on <a href="https://github.com/datameshgroup/fusioncloud-pairing-dotnet-winforms" target="_blank" rel="noopener noreferrer">GitHub</a></td></tr><tr><td style="text-align:center"></td><td>Demo Application using the Pairing NuGet package</td><td>on <a href="https://github.com/datameshgroup/sdk-dotnet-testpos" target="_blank" rel="noopener noreferrer">GitHub</a></td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-scanning-the-qr-code-on-the-poi-terminal">Step 2: Scanning the QR code on the POI Terminal<a class="hash-link" aria-label="Direct link to Step 2: Scanning the QR code on the POI Terminal" title="Direct link to Step 2: Scanning the QR code on the POI Terminal" href="/fusion/docs/getting-started#step-2-scanning-the-qr-code-on-the-poi-terminal">​</a></h5>
<p>Use these <a href="/fusion/docs/appendix#qr-code-pairing">instructions</a> to scan the pairing QR code on the POI Terminal.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-loginrequest-after-pairing">Step 3: LoginRequest after pairing<a class="hash-link" aria-label="Direct link to Step 3: LoginRequest after pairing" title="Direct link to Step 3: LoginRequest after pairing" href="/fusion/docs/getting-started#step-3-loginrequest-after-pairing">​</a></h5>
<p>Once the QR code has been scanned on the POI Terminal, the Sale System must send a pairing LoginRequest:</p>
<ul>
<li>Build a standard <a href="/fusion/docs/api-reference/data-model#login-request">login request</a></li>
<li>Set <a href="/fusion/docs/api-reference/fusion-cloud#messageheader">MessageHeader.SaleID</a> to the <a href="/fusion/docs/getting-started#pairing-qr-code">pairing QR code</a> SaleID value</li>
<li>Only for this specific request, set <a href="/fusion/docs/api-reference/fusion-cloud#messageheader">MessageHeader.POIID</a> to the <a href="/fusion/docs/getting-started#pairing-qr-code">pairing QR code</a> PairingPOIID value</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#login-request">LoginRequest.SaleSoftware.CertificationCode</a> to the <a href="/fusion/docs/getting-started#pairing-qr-code">pairing QR code</a> CertificationCode value</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#login-request">LoginRequest.Pairing</a> to true</li>
</ul>
<p>On successful <a href="/fusion/docs/api-reference/data-model#login-response">login response</a>, the Sale System should record:</p>
<ul>
<li>MessageHeader.POIID from the <em>response</em> (this will be different from the MessageHeader.POIID in the request)</li>
<li>SaleID from the pairing QR Code SaleID value</li>
<li>KEK from the pairing QR Code KEK value</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The stored Sale ID, POI ID (from the Login response), and KEK values will be used in the succeeding request messages (including the actual LoginRequest prior to a PaymentRequest).</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="unpairing-from-terminal">Unpairing from Terminal<a class="hash-link" aria-label="Direct link to Unpairing from Terminal" title="Direct link to Unpairing from Terminal" href="/fusion/docs/getting-started#unpairing-from-terminal">​</a></h5>
<p>Once the Sales System has been paired with a terminal, the Sale System must provide an option to unpair the Sale Sytem from the terminal.  This option will clear the previously stored POI ID value.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The Sale System may use the previously stored Sale ID and KEK values when generating the next pairing QR code.</p></div></div>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/pair-with-pos-5529ab2c88d695bd7925a6c7c3980972.png" width="1114" height="2012" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sample-terminal-to-pos-pairing-dialog">Sample Terminal-to-POS Pairing Dialog<a class="hash-link" aria-label="Direct link to Sample Terminal-to-POS Pairing Dialog" title="Direct link to Sample Terminal-to-POS Pairing Dialog" href="/fusion/docs/getting-started#sample-terminal-to-pos-pairing-dialog">​</a></h5>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/pair-with-pos-qr-code-dialog-38072bbf593e0c2d887cd25ed2afdabc.png" width="659" height="425" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sample-screen-display-when-loginrequest-after-pairing-is-successful">Sample screen display when <a href="/fusion/docs/getting-started#loginrequest-after-pairing">LoginRequest after pairing</a> is successful<a class="hash-link" aria-label="Direct link to sample-screen-display-when-loginrequest-after-pairing-is-successful" title="Direct link to sample-screen-display-when-loginrequest-after-pairing-is-successful" href="/fusion/docs/getting-started#sample-screen-display-when-loginrequest-after-pairing-is-successful">​</a></h5>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/pair-with-pos-qr-code-dialog-pairing-successful-f4920619e455f0d1762d9236ec49f46f.png" width="656" height="426" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sample-screen-display-when-no-terminal-is-paired-with-the-sale-system">Sample screen display when no terminal is paired with the Sale System<a class="hash-link" aria-label="Direct link to Sample screen display when no terminal is paired with the Sale System" title="Direct link to Sample screen display when no terminal is paired with the Sale System" href="/fusion/docs/getting-started#sample-screen-display-when-no-terminal-is-paired-with-the-sale-system">​</a></h5>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/pair-with-pos-not-paired-734fbaccf536727ebf98a5c7d8bb38b9.png" width="599" height="191" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sample-screen-display-when-a-terminal-has-been-paired-successfully-with-the-sale-system">Sample screen display when a terminal has been paired successfully with the Sale System<a class="hash-link" aria-label="Direct link to Sample screen display when a terminal has been paired successfully with the Sale System" title="Direct link to Sample screen display when a terminal has been paired successfully with the Sale System" href="/fusion/docs/getting-started#sample-screen-display-when-a-terminal-has-been-paired-successfully-with-the-sale-system">​</a></h5>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/pair-with-pos-paired-65aacd569ec7efc0660d2afab9570124.png" width="596" height="217" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="payment-types">Payment types<a class="hash-link" aria-label="Direct link to Payment types" title="Direct link to Payment types" href="/fusion/docs/getting-started#payment-types">​</a></h3>
<p>Supported <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment</a> types are:</p>
<ul>
<li>Purchase</li>
<li>Cash-Out</li>
<li>Purchase with Cash-Out</li>
<li>Refund</li>
<li>Pre-Authorisation (for Satellite API)</li>
<li>Completion (for Satellite API)</li>
</ul>
<p>The Sale System indicates the payment type in the payment request with the <a href="/fusion/docs/api-reference/data-model#paymenttype">PaymentType</a> field.</p>
<p>Supported gift card types are:</p>
<ul>
<li>Activation</li>
<li>Deactivation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="payment-identification">Payment identification<a class="hash-link" aria-label="Direct link to Payment identification" title="Direct link to Payment identification" href="/fusion/docs/getting-started#payment-identification">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sale--payment-identification">Sale &amp; payment identification<a class="hash-link" aria-label="Direct link to Sale &amp; payment identification" title="Direct link to Sale &amp; payment identification" href="/fusion/docs/getting-started#sale--payment-identification">​</a></h4>
<ul>
<li>In the Fusion API, a <strong>sale</strong> is a transaction between a buyer and a seller, in which goods or services are exchanged for payment.</li>
<li>Each <strong>sale</strong> can be pair for by one or more <strong>payment</strong> requests.</li>
<li>Each <strong>payment</strong> request and response message is identified by a <code>TransactionIdentification</code> object which contains following the fields:<!-- -->
<ul>
<li><a href="/fusion/docs/api-reference/data-model#transactionid">TransactionID</a></li>
<li><a href="/fusion/docs/api-reference/data-model#timestamp">TimeStamp</a></li>
</ul>
</li>
</ul>
<table><thead><tr><th>Message</th><th><code>TransactionIdentification</code> field</th><th>Description</th></tr></thead><tbody><tr><td>Payment Request</td><td><a href="/fusion/docs/api-reference/data-model#saletransactionid">SaleData.SaleTransactionID</a></td><td><ul><li>Must uniquely identify a sale</li><li>The Sale System must ensure that the <a href="/fusion/docs/api-reference/data-model#saletransactionid">SaleData.SaleTransactionID</a> for each <strong>sale</strong> for a given <a href="/fusion/docs/api-reference/data-model#saleid">SaleID</a> is unique.</li><li>A sale can have multiple payment requests (for example, in the case of split payments, where one sale is paid with multiple payments).</li><li>The <a href="/docs/api-reference/data-model#saletransactionid">SaleTransactionID</a> is the same for each payment request sent for the same sale and from the same <a href="/docs/api-reference/data-model#saleid">SaleID</a></li><li></li></ul></td></tr><tr><td>Payment Response</td><td><a href="/fusion/docs/api-reference/data-model#poitransactionid">SaleData.POITransactionID</a></td><td><ul><li>This uniquely identifies a specific payment</li><li>The POI System will ensure the <a href="/fusion/docs/api-reference/data-model#poitransactionid">SaleData.POITransactionID</a> uniquely identifies a <strong>payment</strong> for a given <a href="/fusion/docs/api-reference/data-model#poiid">POIID</a>.</li><li>A sale can have multiple payment responses (for example, in the case of split payments, where one sale is paid with multiple payments).</li><li>The <a href="/docs/api-reference/data-model#poitransactionid">POITransactionID</a> returned in each payment response is guaranteed to be unique (even for the same sale) for a given <a href="/docs/api-reference/data-model#poiid">POIID</a>.</li></ul></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="requestresponse-identification">Request/response identification<a class="hash-link" aria-label="Direct link to Request/response identification" title="Direct link to Request/response identification" href="/fusion/docs/getting-started#requestresponse-identification">​</a></h4>
<ul>
<li>The <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> field uniquely identifies a specific transaction request in a sale.</li>
<li>Each transaction request and response message are linked via the <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> field.</li>
<li>When processing a response message, the Sale System should verify that the <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> in the payment response or transaction status response message matches the exact <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> value in the payment request message before processing the response message.</li>
<li>The <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> is also used by the Sale System in the <a href="/fusion/docs/api-reference/fusion-cloud#abort-transaction">abort transaction request</a> to cancel a specific payment transaction.  This means that the exact <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> value in the payment request must be provided as the <a href="/fusion/docs/api-reference/data-model#serviceid">ServiceID</a> in the  <a href="/fusion/docs/api-reference/fusion-cloud#abort-transaction">abort transaction request</a> when attempting to cancel that specific payment request.</li>
</ul>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-identification-352140230bf1ee633f1f91767a0bcb02.png" width="695" height="1363" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="receipt-printing">Receipt printing<a class="hash-link" aria-label="Direct link to Receipt printing" title="Direct link to Receipt printing" href="/fusion/docs/getting-started#receipt-printing">​</a></h3>
<p>The POI Terminal will produce payment receipts which must be printed as a part of the transaction flow.</p>
<p>Some terminals have a built-in printer which can handle receipt printing. However, in order to support terminals without a built-in printer and improve the customer experience the Sale System should also handle printing receipts produced by the POI Terminal.</p>
<p>To enable printing receipts from the Sale System, include &quot;PrinterReceipt&quot; in the list of available <a href="/fusion/docs/api-reference/data-model#salecapabilities">SaleTerminalData.SaleCapabilities</a> when sending the <a href="/fusion/docs/api-reference/fusion-cloud#login">LoginRequest</a>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The Sale System must print the receipt as formatted by DataMesh and not create a custom formatted receipt.</p></div></div>
<p>Receipts may be delivered to the Sale System using two methods</p>
<ul>
<li><strong>PrintReceipt request</strong> - One or more PrintReceipt requests may fire during the sale</li>
<li><strong>Payment response</strong> - A customer receipt is returned in the payment response in <a href="/fusion/docs/api-reference/data-model#outputxhtml">OutputContent.OutputXHTML</a> formatted as the format defined in <a href="/fusion/docs/api-reference/data-model#outputformat">OutputContent.OutputFormat</a></li>
</ul>
<p>It is recommended that the Sale System embed the customer payment receipt content in the customer sale receipt produced by the Sale System.</p>
<p><em>Example receipt format</em></p>
<div style="color:black;background:white;font-family:monospace;width:200px"><p>*** CUSTOMER COPY ***            <br>
DD/MM/YYYY hh:mm<!-- -->:ss<!-- -->              <br>
Merchant ID: XXXXXXXX            <br>
Terminal ID: XXXXXXXX            <br></p><br><p><b>Purchase Transaction</b>      <br><br>
<!-- -->Amount:          $10.00          <br>
Tip:              $1.00          <br>
Surcharge 2.00%:  $0.22          <br>
-----------------------          <br>
Total Amount:    $11.22          <br></p><br><p>VISA: 4xxxxxxxxxxxxxxx(T)        <br>
Credit Account                   <br></p><br><b>Approved</b><br><br><p>Reference: 0000 0000 0000        <br>
Auth Code: 000000                <br>
AID: A0000000000000000           <br>
ATC: 000X                        <br>
TVR: 000000000000                <br>
ARQC: XXXXXXXXXXXXXXXX           <br></p></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="payment-user-interface">Payment user interface<a class="hash-link" aria-label="Direct link to Payment user interface" title="Direct link to Payment user interface" href="/fusion/docs/getting-started#payment-user-interface">​</a></h3>
<div class="theme-admonition theme-admonition-success admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>success</div><div class="admonitionContent_BuS1"><p>The payment user interface settings are only required for the <a href="/fusion/docs/getting-started#fusion-cloud">Fusion Cloud</a> integration type. If you are using <strong>Fusion App</strong> or <strong>Fusion Satellite</strong> you can skip this section.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The Sale System should implement <code>Initial UI</code>, <code>Final UI</code>, <code>Display UI</code> and the ability to <code>cancel a sale in progress</code>.</p><p>The <code>Input UI</code> elements are not currently available, and will be supported by a future Unify release. Support for these elements by the Sale System is optional.</p></div></div>
<p>If capable, the Sale System should present UI to the cashier for the duration of a payment. The content of the UI is set by the <a href="/fusion/docs/api-reference/fusion-cloud#input">input</a> and <a href="/fusion/docs/api-reference/fusion-cloud#display">display</a> request messages sent from the POI System.</p>
<p>In the examples presented below the UI is contained in a modal shadow box. This is an example to help illustrate how this UI may be implemented. The Sale System should implement this UI in a way that fits the look and feel of the rest of the system.</p>
<p>The Sale System must not block communication with the POI System when displaying the payments UI. The POI System may send a display or input request, followed by another display or input request, or the payment response. For example, the POI System may send a &quot;SELECT ACCOUNT&quot; display, followed by a &quot;PROCESSING&quot; display when the card holder selects their account on the POI terminal. The POI System may send a &quot;SIGNATURE APPROVED&quot; input request, followed by a &quot;TIMEOUT&quot; display and payment response, if the cashier doesn&#x27;t approve the signature in time.</p>
<p>To enable display and input handling on the Sale System, <a href="/fusion/docs/api-reference/data-model#salecapabilities">SaleTerminalData.SaleCapabilities</a> in the <a href="/fusion/docs/api-reference/fusion-cloud#login">login</a> request contains &quot;CashierStatus&quot;, &quot;CashierError&quot;, &quot;CashierInput&quot;, and &quot;CustomerAssistance&quot;.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The DataMesh Nexo API is event based. The Sale System sends a payment request, handles events as they are received, and eventually receives a payment response.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="initial-ui">Initial UI<a class="hash-link" aria-label="Direct link to Initial UI" title="Direct link to Initial UI" href="/fusion/docs/getting-started#initial-ui">​</a></h4>
<p>The Sale System should immediately display an initial UI after sending a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment</a> request which informs the cashier the payment is in progress. This UI is required to handle instances where the first display/input message from the POI System is not present, or delayed.</p>
<p>This UI should also enable the cashier to request a cancellation of the transaction.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-initial-ui-38168973bc26e216cb470e682664097f.png" width="721" height="561" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="display-ui">Display UI<a class="hash-link" aria-label="Direct link to Display UI" title="Direct link to Display UI" href="/fusion/docs/getting-started#display-ui">​</a></h4>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Display request</summary><div><div class="collapsibleContent_i85q"><div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;SaleToPOIRequest&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;MessageHeader&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;MessageClass&quot;:&quot;Device&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;MessageCategory&quot;:&quot;Display&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;MessageType&quot;:&quot;Request&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;ServiceID&quot;:&quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;DeviceID&quot;:&quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;SaleID&quot;:&quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;POIID&quot;:&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;DisplayRequest&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;DisplayOutput&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ResponseRequiredFlag&quot;:false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Device&quot;:&quot;CashierDisplay&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;InfoQualify&quot;:&quot;Status&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;OutputContent&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;OutputFormat&quot;:&quot;Text&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;OutputText&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;Text&quot;:&quot;LINE OF TEXT MAX 40 CHARACTERS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;SecurityTrailer&quot;:{...}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details>
<p>The POI system will send zero or more <a href="/fusion/docs/api-reference/fusion-cloud#display">display request</a> messages to the Sale System during a transaction. The Sale System should display these messages and continue to wait for the payment response.</p>
<ul>
<li>Each display request will contain at least 1 line of text.</li>
<li>Each line of text will be up to 40 characters wide.</li>
<li>The POI System should display the text centred.</li>
<li>The POI System should include the option to cancel the transaction.</li>
<li>The POI System should display an &quot;in progress&quot; indicator to the cashier.</li>
<li>The POI System may optionally colour the display text based on the <a href="/fusion/docs/api-reference/data-model#infoqualify">InfoQualify</a> field set as &quot;Error&quot; or &quot;Status&quot;</li>
</ul>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-display-1677a8602ca14189745171ce2143aa58.png" width="721" height="561" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-ui">Input UI<a class="hash-link" aria-label="Direct link to Input UI" title="Direct link to Input UI" href="/fusion/docs/getting-started#input-ui">​</a></h4>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>Input UI</code> elements are not currently available, and will be supported by a future Unify release. Support for these elements by the Sale System is optional.</p></div></div>
<p>The POI system will send zero or more <a href="/fusion/docs/api-reference/fusion-cloud#input">input request</a> messages to the Sale System during a transaction. The Sale System should display these input requests, allow the cashier the option to answer the input request, and continue to wait for the payment response. The Sale System should not block on an input request, as the POI System may continue with the transaction before the Sale System has sent an input response.</p>
<ul>
<li>There are six types of input request. The <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> indicates which input request type the Sale System should present:<!-- -->
<ul>
<li>GetAnyKey - Wait for any key press. For example, to get confirmation from the cashier that a display has been read.</li>
<li>GetConfirmation - Yes/No answer as in the case when prompting for &quot;Signature OK?&quot;. The result of this command is boolean true/false.</li>
<li>Password - A merchant password as in the case during a refund transaction.</li>
<li>GetMenuEntry - A selection from a list of options. For example, assisting the card holder by selecting the account type: Savings, Cheque or Credit.</li>
<li>TextString - A text string.</li>
<li>DigitString - A string of digits.</li>
<li>DecimalString - A string of digits with a decimal point.</li>
</ul>
</li>
<li>The input request has a single line of text, up to 40 characters wide.</li>
<li>The POI System should display the text centred.</li>
<li>The POI System should include the option to cancel the transaction.</li>
<li>The <a href="/fusion/docs/getting-started#minlength">MinLength</a> and <a href="/fusion/docs/getting-started#maxlength">MaxLength</a> fields may be present for some input commands.</li>
<li>The <a href="/fusion/docs/getting-started#maxinputtime">MaxInputTime</a> field may be present which indicates the input timeout in seconds.</li>
</ul>
<p><strong>Input - GetAnyKey</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;GetAnyKey&quot; indicates the Sale System should wait for any key press. This is most often used to display a request which the cashier must acknowledge to continue.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-getanykey-cd7102f0cf120d2b9353282553586099.png" width="721" height="561" class="img_ev3q"></p>
<p><strong>Input - GetConfirmation</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;GetConfirmation&quot; indicates the Sale System should present a yes/no option to the cashier. The response to this request is boolean true/false.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The option for the cashier to &#x27;Cancel&#x27; is optional on the <code>GetConfirmation</code> input UI.</p></div></div>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-getconfirmation-478f9325f4fa1bb97a93a41e4098a029.png" width="721" height="561" class="img_ev3q"></p>
<p><strong>Input - Password</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;Password&quot; indicates the Sale System should allow the user to enter text of any format as a password.</p>
<p>The Sale System should ensure cashier input conforms to <a href="/fusion/docs/getting-started#minlength">MinLength</a> and/or <a href="/fusion/docs/getting-started#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>
<p>The <a href="/fusion/docs/getting-started#maskcharactersflag">MaskCharactersFlag</a> field indicates if the Sale System should mask the cashier input on screen.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-getpassword-3e281e305ab1c0a5cb090df5d9c71372.png" width="721" height="561" class="img_ev3q"></p>
<p><strong>Input - TextString</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;TextString&quot; indicates the Sale System should allow the user to enter text of any format.</p>
<p>The Sale System should ensure cashier input conforms to <a href="/fusion/docs/getting-started#minlength">MinLength</a> and/or <a href="/fusion/docs/getting-started#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-textstring-61b32762ea9f476cc46e6319f7bb3be5.png" width="721" height="561" class="img_ev3q"></p>
<p><strong>Input - DigitString</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;DigitString&quot; indicates the Sale System should allow the user to enter a string of digits only.</p>
<p>The Sale System should ensure cashier input conforms to <a href="/fusion/docs/getting-started#minlength">MinLength</a> and/or <a href="/fusion/docs/getting-started#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-digitstring-0e8a48316dc21a3ea1bd64dd5a3edbe6.png" width="721" height="561" class="img_ev3q"></p>
<p><strong>Input - DecimalString</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;DigitString&quot; indicates the Sale System should allow the user to enter a string of digits with a decimal point (e.g. an amount)</p>
<p>The Sale System should ensure cashier input conforms to <a href="/fusion/docs/getting-started#minlength">MinLength</a> and/or <a href="/fusion/docs/getting-started#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-decimalstring-758935b555ce0769efb9c5bc1f9a73d8.png" width="721" height="561" class="img_ev3q"></p>
<p><strong>Input - GetMenuEntry</strong></p>
<p>An <a href="/fusion/docs/api-reference/data-model#inputcommand">InputCommand</a> of &quot;GetMenuEntry&quot; indicates the Sale System should allow the cashier to select one of a number of options available.</p>
<p>The number of available options will be 1..n. The <code>MenuEntry</code> object contains the options to be displayed.</p>
<p><em>Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-input-getmenuentry-73002f2907591978f39f1c942edbf5d8.png" width="721" height="561" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="final-ui">Final UI<a class="hash-link" aria-label="Direct link to Final UI" title="Direct link to Final UI" href="/fusion/docs/getting-started#final-ui">​</a></h4>
<p>The Sale System should display a final UI after the response has been received to inform the cashier of the transaction result.</p>
<p>This UI is constructed using the <a href="/fusion/docs/api-reference/data-model#result">Result</a>, <a href="/fusion/docs/api-reference/data-model#errorcondition">ErrorCondition</a>, and <a href="/fusion/docs/api-reference/data-model#additionalresponse">AdditionalResponse</a> fields of the <code>Response</code> object.</p>
<p><em>Result=&quot;Success&quot; Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-final-ui-success-715ddd3e7a6e376111847af225756134.png" width="721" height="561" class="img_ev3q"></p>
<p><em>Result=&quot;Failure&quot; Example</em></p>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/dialog-final-ui-failure-022f5c2628e02f0e6247b7cc9319ab81.png" width="721" height="561" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cancelling-a-sale-in-progress">Cancelling a sale in progress<a class="hash-link" aria-label="Direct link to Cancelling a sale in progress" title="Direct link to Cancelling a sale in progress" href="/fusion/docs/getting-started#cancelling-a-sale-in-progress">​</a></h4>
<p>Whilst a payment is in progress the Sale System should present UI to the cashier which enables them to request a cancellation of the payment.</p>
<p>If the cashier initiates a payment cancellation, the Sale System sends an <a href="/fusion/docs/api-reference/fusion-cloud#abort-transaction">abort transaction request</a> (with <code>AbortRequest.AbortReason</code> field set to &quot;User Cancel&quot;).  Then, the Sale System continues to wait for the payment response.</p>
<p>The Sale System may allow the cashier to continue to request cancellation of the payment until a payment result has been received.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>There are a number of instances where the Terminal may be unable to cancel a payment in progress upon receiving a <a href="#abort-transaction">abort transaction request</a>. The Sale System must <b>always</b> await a payment response after sending an abort transaction request.  If no response is received or an error has occurred before a response is received, the Sale System must peform <a href="/docs/api-reference/fusion-cloud#error-handling">error handling</a>.</p></div></div>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-cancellation-3796dd67ddf46288dd15ad9953186924.png" width="826" height="1113" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="product-data">Product data<a class="hash-link" aria-label="Direct link to Product data" title="Direct link to Product data" href="/fusion/docs/getting-started#product-data">​</a></h3>
<div class="theme-admonition theme-admonition-success admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>success</div><div class="admonitionContent_BuS1"><p>Product data is mandatory for all requests.</p></div></div>
<p>The Sale System must include product information about the sale items attached to each purchase request.</p>
<p>It can accomplish this by including an array of <a href="/fusion/docs/api-reference/data-model#saleitem">SaleItem</a> objects in the <code>PaymentRequest</code>.</p>
<p>Each <a href="/fusion/docs/api-reference/data-model#saleitem">SaleItem</a> record contains the following mandatory fields:</p>
<ul>
<li><strong>ItemID</strong> a unique identifier for the sale item within the context of this payment. e.g. a 0..n integer which increments by one for each sale item.</li>
<li><strong>ProductCode</strong> - a unique identifier for the product within the merchant, such as the SKU. For example if two customers purchase the same product at two different stores owned by the merchant, both purchases should contain the same <code>ProductCode</code>.</li>
<li><strong>ItemAmount</strong> - total amount of the sale item.</li>
<li><strong>ProductLabel</strong> - a short, human readable, descriptive name of the product.  For example, <code>ProductLabel</code> could contain the product name typically printed on the customer receipt.</li>
<li><strong>Quantity</strong> - item unit quantity</li>
<li><strong>UnitOfMeasure</strong> - unit of measure of the <code>Quantity</code>. See <a href="/fusion/docs/api-reference/data-model#unitofmeasure">UnitOfMeasure</a></li>
<li><strong>UnitPrice</strong> - price per item unit.</li>
</ul>
<p>See <a href="/fusion/docs/api-reference/data-model#saleitem">SaleItem</a> for all available fields and examples.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Including all available product information in each payment request will improve the merchant experiance. See <a href="/docs/api-reference/data-model#saleitem">SaleItem</a> for a full list of available fields.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="refunds">Refunds<a class="hash-link" aria-label="Direct link to Refunds" title="Direct link to Refunds" href="/fusion/docs/getting-started#refunds">​</a></h3>
<p>Refund is paying back the customer the amount corresponding to some or all of the goods/services that the customer previously availed. The total refund amount must include any surcharge amount applied to the specific goods/services in the original sale transaction.</p>
<p>Types of Refund:</p>
<ul>
<li>
<p><a href="/fusion/docs/getting-started#matched-refund">Matched refund</a></p>
</li>
<li>
<p><a href="/fusion/docs/getting-started#unmatched-refund">Unmatched refund</a></p>
</li>
</ul>
<p>More details about the <a href="/fusion/docs/api-reference/data-model#saleitem-refunds">refund implementation</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="matched-refund">Matched refund<a class="hash-link" aria-label="Direct link to Matched refund" title="Direct link to Matched refund" href="/fusion/docs/getting-started#matched-refund">​</a></h4>
<ul>
<li>A matched refund is paired with an original purchase.</li>
<li>The Sale System must specify the <a href="/fusion/docs/api-reference/data-model#poitransactionid">POITransactionID</a> from the original payment response message in the <a href="/fusion/docs/api-reference/data-model#originalpoitransaction">OriginalPOITransaction</a> field of the refund payment request message.</li>
<li>When <a href="/fusion/docs/getting-started#dynamic-surcharge">dynamic surcharge</a> is enabled:<!-- -->
<ul>
<li>The matched refund should include the surcharged amount.</li>
<li>The total amount must be equal to the original purchase amount + dynamic surcharge amount.</li>
</ul>
</li>
<li>When <a href="/fusion/docs/getting-started#dynamic-surcharge">dynamic surcharge</a> is &quot;NOT&quot; enabled:</li>
<li>The total amount must be equal to the original purchase amount.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="unmatched-refund">Unmatched refund<a class="hash-link" aria-label="Direct link to Unmatched refund" title="Direct link to Unmatched refund" href="/fusion/docs/getting-started#unmatched-refund">​</a></h4>
<ul>
<li>An unmatched refund is not paired with an original purchase.</li>
<li>Unmatched refunds don&#x27;t have any extra requirements/restrictions.</li>
<li>When <a href="/fusion/docs/getting-started#dynamic-surcharge">dynamic surcharge</a> is enabled:</li>
<li>The total amount must be equal to the purchase amount to be refunded + portion of the surcharge amount, which corresponds to the purchase amount to be refunded.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Currently, both Matched and Unmatched refunds involve POI Terminal and card interaction.</p></div></div>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-refund-2b5b70cdb37cae800aa85da132f2ddbd.png" width="846" height="1092" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cash-out">Cash out<a class="hash-link" aria-label="Direct link to Cash out" title="Direct link to Cash out" href="/fusion/docs/getting-started#cash-out">​</a></h3>
<p>The Sale System can optionally support cash out payments on the POI Terminal. There are two cash out methods supported based on where the cash out amount is entered; cash out on Sale System, and cash out on POI Terminal.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cash-out-on-sale-system">Cash out on Sale System<a class="hash-link" aria-label="Direct link to Cash out on Sale System" title="Direct link to Cash out on Sale System" href="/fusion/docs/getting-started#cash-out-on-sale-system">​</a></h4>
<p>When perfoming cash out on the Sale System, the cash out amount is entered by the cashier on the Sale System before the purchase is sent.</p>
<p>A cash out sale can be cash out only, or cash out + purchase.</p>
<ul>
<li>Cash out only (no sale items are included)<!-- -->
<ul>
<li>Set <a href="/fusion/docs/api-reference/data-model#paymenttype">PaymentData.PaymentType</a> to &quot;CashAdvance&quot;</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to the cash out amount</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> to the cash out amount</li>
</ul>
</li>
<li>Purchase plus cash out (sale items are included)<!-- -->
<ul>
<li>Set <a href="/fusion/docs/api-reference/data-model#paymenttype">PaymentData.PaymentType</a> to &quot;Normal&quot;</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to the value of the sale items, plus the cash out amount</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> to the cash out amount</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-auth--completion">Pre-auth / completion<a class="hash-link" aria-label="Direct link to Pre-auth / completion" title="Direct link to Pre-auth / completion" href="/fusion/docs/getting-started#pre-auth--completion">​</a></h3>
<p>The Sale System can optionally support pre-authorisation and completion payments on the POI Terminal.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The Pre-authorisation and Completion transactions are currently available only for the Satellite API.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pre-authorisation">Pre-authorisation<a class="hash-link" aria-label="Direct link to Pre-authorisation" title="Direct link to Pre-authorisation" href="/fusion/docs/getting-started#pre-authorisation">​</a></h4>
<p>Pre-authorisation holds funds in reserve on a customers card and allows the payment to be completed at a later date.</p>
<p>To perform a pre-authorisation:</p>
<ul>
<li>Build a standard <a href="/fusion/docs/api-reference/fusion-satellite#payment">payment request</a></li>
<li>Set <a href="/fusion/docs/api-reference/data-model#paymenttype">PaymentRequest.PaymentData.PaymentType</a> to &quot;FirstReservation&quot;</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentRequest.PaymentTransaction.AmountsReq.RequestedAmount</a> to the amount to reserve</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#salereferenceid">PaymentRequest.SaleData.SaleReferenceID</a> to a unique <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="_blank" rel="noopener noreferrer">UUID</a></li>
</ul>
<p>On pre-authorisation response, the POS should record:</p>
<ul>
<li><a href="/fusion/docs/api-reference/data-model#salereferenceid">PaymentRequest.SaleData.SaleReferenceID</a> from the request</li>
<li><a href="/fusion/docs/api-reference/data-model#poitransactionid">PaymentResponse.POIData.POITransactionID</a> from the response</li>
<li><a href="/fusion/docs/api-reference/data-model#authorizedamount">PaymentResponse.PaymentResult.AmountsResp.AuthorizedAmount</a> from the response (the reserved amount)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="completion">Completion<a class="hash-link" aria-label="Direct link to Completion" title="Direct link to Completion" href="/fusion/docs/getting-started#completion">​</a></h4>
<p>Completion captures/settles payment of the amount previously reserved through pre-authorisation.</p>
<p>To perform a completion:</p>
<ul>
<li>Build a standard <a href="/fusion/docs/api-reference/fusion-satellite#payment">payment request</a></li>
<li>Set <a href="/fusion/docs/api-reference/data-model#paymenttype">PaymentRequest.PaymentData.PaymentType</a> to &quot;Completion&quot;</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentRequest.PaymentTransaction.AmountsReq.RequestedAmount</a> the completion amount. Must be less than or equal to reserved amount</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#salereferenceid">PaymentRequest.SaleData.SaleReferenceID</a> to the same <code>SaleReferenceID</code> as used in the pre-authoristaion request</li>
<li>Set <a href="/fusion/docs/api-reference/data-model#poitransactionid">PaymentRequest.PaymentTransaction.OriginalPOITransaction.POITransactionID</a> to the value returned in <a href="/fusion/docs/api-reference/data-model#poitransactionid">PaymentResponse.POIData.POITransactionID</a> from the original pre-authorisation response</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="settlement">Settlement<a class="hash-link" aria-label="Direct link to Settlement" title="Direct link to Settlement" href="/fusion/docs/getting-started#settlement">​</a></h3>
<p>The Sale System can reconcile with the POI System periodically but should normally be once a day as it affects settlements with acquirers.</p>
<p>Use the <a href="/fusion/docs/api-reference/fusion-cloud#reconciliation">Reconciliation</a> request to initiate a settlement.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tokenisation">Tokenisation<a class="hash-link" aria-label="Direct link to Tokenisation" title="Direct link to Tokenisation" href="/fusion/docs/getting-started#tokenisation">​</a></h3>
<p>Cards can be pre-tokenised by the Sale System if required. This supports mobile apps, eCommerce and Sale System type systems.</p>
<p>Customer tokens are supported:</p>
<ul>
<li><strong>Customer</strong> - token which is scoped to the customer. For example, if the same card is tokenised on two different POI Terminals owned by the merchant, the same token will be returned. A <code>Customer</code> token can be used to represent the card holder and perform operations for a longer period.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tokenise-a-card-used-for-a-payment">Tokenise a card used for a payment<a class="hash-link" aria-label="Direct link to Tokenise a card used for a payment" title="Direct link to Tokenise a card used for a payment" href="/fusion/docs/getting-started#tokenise-a-card-used-for-a-payment">​</a></h4>
<p>To tokenise a card as part of a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment</a>, set <a href="/fusion/docs/api-reference/data-model#tokenrequestedtype">SaleData.TokenRequestedType</a> in the payment request to &quot;Transaction&quot; or &quot;Customer&quot;.</p>
<p>When <a href="/fusion/docs/api-reference/data-model#tokenrequestedtype">SaleData.TokenRequestedType</a> is set, the token will be returned as part of the payment response in <a href="/fusion/docs/api-reference/data-model#paymenttoken">PaymentResult.PaymentInstrumentData.CardData.PaymentToken</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tokenise-a-card-without-payment">Tokenise a card without payment<a class="hash-link" aria-label="Direct link to Tokenise a card without payment" title="Direct link to Tokenise a card without payment" href="/fusion/docs/getting-started#tokenise-a-card-without-payment">​</a></h4>
<p>The <a href="/fusion/docs/api-reference/fusion-cloud#card-acquisition">card acquisition</a> request allows the Sale System to tokenise a card which can be used in future payment requests.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="partial-payments">Partial payments<a class="hash-link" aria-label="Direct link to Partial payments" title="Direct link to Partial payments" href="/fusion/docs/getting-started#partial-payments">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Partial payments are only supported in selected payment scenarios and requires the &quot;PartialPayment&quot; feature to be enabled in the terminal configuration. Contact the DataMesh <a href="mailto:integrations@datameshgroup.com" target="_blank" rel="noopener noreferrer">integrations team</a> before implementing partial payments.</p></div></div>
<p>When the &quot;PartialPayment&quot; feature is enabled, the POI Terminal may approve a purchase for less than the <a href="/fusion/docs/api-reference/data-model#requestedamount">RequestedAmount</a> passed in by the Sale System.</p>
<p>This feature can be used in conjunction with <a href="/fusion/docs/getting-started#split-payments">split payments</a> to accept loyalty and stored value card payments where the value available on the card may be less than the total <a href="/fusion/docs/api-reference/data-model#requestedamount">RequestedAmount</a>.</p>
<p><strong>Handling a partial payment</strong></p>
<ul>
<li>Ensure the &quot;PartialPayment&quot; feature has been enabled on the POI Terminal</li>
<li>Send a <a href="/fusion/docs/api-reference/fusion-cloud#paymentrequest">payment request</a>, including all required fields<!-- -->
<ul>
<li>Set the maximum payable purchase amount in <a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a></li>
</ul>
</li>
<li>Await the payment response and check <a href="/fusion/docs/api-reference/data-model#result">Response.Result</a> for the transaction result.</li>
<li>If <a href="/fusion/docs/api-reference/data-model#result">Response.Result</a> is &quot;Partial&quot; the payment has been approved for an amount less than the the <a href="/fusion/docs/api-reference/data-model#requestedamount">RequestedAmount</a>
<ul>
<li><a href="/fusion/docs/api-reference/data-model#result">PaymentResponse.Response.Result</a> will be &quot;Partial&quot;</li>
<li><a href="/fusion/docs/api-reference/data-model#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> will reflect the full authorized amount (including all fees, tips, and surcharges)</li>
<li><a href="/fusion/docs/api-reference/data-model#partialauthorizedamount">PaymentResult.AmountsResp.PartialAuthorizedAmount</a> will reflect the amount of <a href="/fusion/docs/api-reference/data-model#requestedamount">RequestedAmount</a> which has been authorised.</li>
</ul>
</li>
<li>Reduce the sale amount owing by <a href="/fusion/docs/api-reference/data-model#partialauthorizedamount">PartialAuthorizedAmount</a> and offer the customer a way to provide further payment.<!-- -->
<ul>
<li>If the remaining amount is to be paid using the POI Terminal, follow the steps outlined in <a href="/fusion/docs/getting-started#split-payments">split payments</a></li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>Sale System sends payment request of $100.00 to DataMesh<!-- -->
<ul>
<li><a href="/fusion/docs/api-reference/data-model#authorizedamount">PaymentTransaction.AmountsReq.AuthorizedAmount</a> = $100.00</li>
</ul>
</li>
<li>DataMesh terminal calculates an added surcharge of $1.00 and adds it to the total amount</li>
<li>Cardholder presents a stored value card with $42 available</li>
<li>DataMesh POI Terminal completes the payment for $42 and returns a response to the POS<!-- -->
<ul>
<li><a href="/fusion/docs/api-reference/data-model#result">PaymentResponse.Response.Result</a> is &quot;Partial&quot;</li>
<li><a href="/fusion/docs/api-reference/data-model#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> is $42.00</li>
<li><a href="/fusion/docs/api-reference/data-model#partialauthorizedamount">PaymentResult.AmountsResp.PartialAuthorizedAmount</a> is $41.00</li>
<li><a href="/fusion/docs/api-reference/data-model#surchargeamount">PaymentResult.AmountsResp.SurchargeAmount</a> is $1.00</li>
</ul>
</li>
<li>Sale System reduces the outstanding amount by $41.00 and offers the cardholder the option to pay the remaining $59.00</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="split-payments">Split payments<a class="hash-link" aria-label="Direct link to Split payments" title="Direct link to Split payments" href="/fusion/docs/getting-started#split-payments">​</a></h3>
<p>To perform a split payment, the Sale System should send multiple <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment</a> requests, one for each split.</p>
<p>Split is allowed when <a href="/fusion/docs/api-reference/data-model#paymenttype">PaymentType</a> is &quot;Normal&quot;.</p>
<p>The following data elements should be set by the Sale System for a split payment in a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment</a> request:</p>
<ul>
<li>All split payments which are part of the same sale should include the same <a href="/fusion/docs/api-reference/data-model#saletransactionid">SaleData.SaleTransactionID</a>.</li>
<li><a href="/fusion/docs/api-reference/data-model#saleitem">PaymentTransaction.SaleItem</a> array, which may reflect<!-- -->
<ul>
<li>Just the items involved in that payment, in the case of a split basket.</li>
<li>All the items in the sale, in the case the sale is being split by amount. Note when splitting by amount the sum of the item amounts could more than the <a href="/fusion/docs/api-reference/data-model#requestedamount">RequestedAmount</a>.</li>
</ul>
</li>
<li><a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> set to the amount of the split payment</li>
<li><a href="/fusion/docs/api-reference/data-model#splitpaymentflag">PaymentData.SplitPaymentFlag</a> set to true</li>
<li><a href="/fusion/docs/api-reference/data-model#minimumsplitamount">PaymentTransaction.AmountsReq.MinimumSplitAmount</a> set to the minimum split amount</li>
<li><a href="/fusion/docs/api-reference/data-model#paidamount">PaymentTransaction.AmountsReq.PaidAmount</a> set to the total amount of previous split payment associated with this sale</li>
</ul>
<p>An example, when splitting by sale item:</p>
<ul>
<li>A sale contains two items, &quot;Product A&quot; ($80) and &quot;Product B&quot; ($20)</li>
<li>The card holder wishes to pay for each item with a different card</li>
<li>The cashier sends the first payment for $80, the basket contains &quot;Product A&quot;</li>
<li>The cashier sends a second payment for $20, the basket contains &quot;Product B&quot;</li>
</ul>
<p>An example, when splitting by amount:</p>
<ul>
<li>A sale contains two items, &quot;Product A&quot; ($80) and &quot;Product B&quot; ($20)</li>
<li>The card holder wishes to split the sale equally between two cards</li>
<li>The cashier sends the first payment for $50, the basket contains both &quot;Product A&quot; and &quot;Product B&quot;</li>
<li>The cashier sends a second payment for $50, the basket contains both &quot;Product A&quot; and &quot;Product B&quot;</li>
</ul>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-split-c9cefba5bdf6e892926bf8f593f71bd9.png" width="689" height="994" class="img_ev3q"></p>
<p>An example, when splitting after a partial payment:</p>
<ul>
<li>A sale contains two items, &quot;Product A&quot; ($80) and &quot;Product B&quot; ($20)</li>
<li>The card holder wishes to pay with a stored value card</li>
<li>The cashier sends the payment request for $100, the basket contains both &quot;Product A&quot; and &quot;Product B&quot;</li>
<li>The payment is partially approved for $40</li>
<li>The Sale System reduces the outstanding amount by $40</li>
<li>The cashier sends a second payment for $60, the basket contains both &quot;Product A&quot; and &quot;Product B&quot;</li>
</ul>
<p><img decoding="async" loading="lazy" src="/fusion/assets/images/payment-split-partial-ae5fe6c65ce3ba61ca2d39ce149b13da.png" width="789" height="1837" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tipping">Tipping<a class="hash-link" aria-label="Direct link to Tipping" title="Direct link to Tipping" href="/fusion/docs/getting-started#tipping">​</a></h3>
<p>There are two tipping methods supported; tip on Sale System, and tip on POI Terminal.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tip-on-sale-system">Tip on Sale System<a class="hash-link" aria-label="Direct link to Tip on Sale System" title="Direct link to Tip on Sale System" href="/fusion/docs/getting-started#tip-on-sale-system">​</a></h4>
<p>When tipping on the Sale System the tip amount is entered by the cashier on the Sale System before the purchase is sent.</p>
<p>For example:</p>
<ol>
<li>Cashier prints a sale ticket for $100 and presents to the card holder</li>
<li>Card holder signs and writes a tip of $10</li>
<li>Cashier opens $100 sale on the Sale System, enters tip of $10 and initiates payment</li>
<li>Sale System sends a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment request</a> request to the POI Terminal and sets</li>
</ol>
<ul>
<li><a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to $110 (sale amount + tip)</li>
<li><a href="/fusion/docs/api-reference/data-model#tipamount">PaymentTransaction.AmountsReq.TipAmount</a> to $10</li>
</ul>
<ol>
<li>POI Terminal processes a payment of $110 and includes tip amount on the payment receipt</li>
<li>POI Terminal approves payment and returns the result to the Sale System</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>If the <a href="/docs/api-reference/data-model#tipamount">PaymentTransaction.AmountsReq.TipAmount</a> is set to 0 in the payment request, the Tip Entry screen will be displayed in the POI terminal.<br>Do not set <a href="/docs/api-reference/data-model#tipamount">PaymentTransaction.AmountsReq.TipAmount</a> to 0 if you don&#x27;t want the Tip Entry screen to be displayed in the POI terminal.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tip-on-poi-terminal">Tip on POI Terminal<a class="hash-link" aria-label="Direct link to Tip on POI Terminal" title="Direct link to Tip on POI Terminal" href="/fusion/docs/getting-started#tip-on-poi-terminal">​</a></h4>
<p>When tipping on the POI Terminal, the Sale System sends the payment request to the POI Terminal without a tip. The POI Terminal gives the option for the card holder to enter a tip amount. The payment response will contain any tip entered by the card holder.</p>
<p>For example:</p>
<ol>
<li>Cashier opens $100 sale on the Sale System and initiates payment</li>
<li>Sale System sends a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment request</a> request to the POI Terminal and sets</li>
</ol>
<ul>
<li><a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to $100 (sale amount + tip)</li>
<li><a href="/fusion/docs/api-reference/data-model#tipamount">PaymentTransaction.AmountsReq.TipAmount</a> to $0</li>
</ul>
<ol>
<li>POI Terminal presents UI to the card holder which allows them to enter a tip</li>
<li>Card holder enters tip amount of $10</li>
<li>POI Terminal processes a payment of $110 and includes tip amount on the payment receipt</li>
<li>POI Terminal approves payment and returns the result to the Sale System with</li>
</ol>
<ul>
<li><a href="/fusion/docs/api-reference/data-model#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> set to $110</li>
<li><a href="/fusion/docs/api-reference/data-model#tipamount">PaymentResult.AmountsResp.TipAmount</a> set to $10</li>
</ul>
<ol>
<li>The Sale System records the approved payment, and optionally records the tip amount of $10</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The amount returned in <a href="#authorizedamount">AuthorizedAmount</a> in the payment result may be differ from the <a href="/docs/api-reference/data-model#requestedamount">RequestedAmount</a> sent in the payment request</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-surcharge">Dynamic surcharge<a class="hash-link" aria-label="Direct link to Dynamic surcharge" title="Direct link to Dynamic surcharge" href="/fusion/docs/getting-started#dynamic-surcharge">​</a></h3>
<p>Dynamic surcharging allows the merchant to recover their &#x27;cost of acceptance&#x27; by enabling the POI Terminal to automatically add a surcharge percentage to the purchase amount based on the card type presented by the customer.</p>
<p>A distinct percentage can be applied to the card types:</p>
<ul>
<li>Visa / MasterCard credit</li>
<li>Debit (EFTPOS or Visa or MasterCard)</li>
<li>Amex / Diners</li>
</ul>
<p>The dynamic surcharging settings are managed on Unify per merchant. In development, contact <a href="mailto:integrations@datameshgroup.com" target="_blank" rel="noopener noreferrer">DataMesh</a> to configure dynamic surcharging on your development account.</p>
<p>Dynamic surcharge example:</p>
<ol>
<li>Merchant enables dynamic surcharge on Unify for their terminal fleet and configures a 1.9% surcharge on Amex/Diners cards</li>
<li>Cashier opens $100 sale on the Sale System and initiates payment</li>
<li>Sale System sends a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment request</a> request to the POI Terminal and sets <a href="/fusion/docs/api-reference/data-model#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to $100</li>
<li>Card holder presents their Amex card</li>
<li>POI Terminal calcualtes new total based on the card type and processes a payment of $101.90</li>
<li>POI Terminal approves payment and returns the result to the Sale System with</li>
</ol>
<ul>
<li>A receipt containing lines with the requested amount, surcharge percentage, surcharge amount, and new total amount</li>
<li><a href="/fusion/docs/api-reference/data-model#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> set to $101.90</li>
<li><a href="/fusion/docs/api-reference/data-model#surchargeamount">PaymentResult.AmountsResp.SurchargeAmount</a> set to $1.90</li>
</ul>
<ol>
<li>The Sale System records the <code>AuthorizedAmount</code>, and optionally records the <code>SurchargeAmount</code> of $1.90</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The amount returned in <a href="#authorizedamount">AuthorizedAmount</a> in the payment result may be differ from the <a href="/docs/api-reference/data-model#requestedamount">RequestedAmount</a> sent in the payment request</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="merchant-responsibilities">Merchant responsibilities<a class="hash-link" aria-label="Direct link to Merchant responsibilities" title="Direct link to Merchant responsibilities" href="/fusion/docs/getting-started#merchant-responsibilities">​</a></h4>
<ul>
<li>Merchants are required to notify the cardholder that a surcharge will be applied. For example, by ensuring signage at the point of purchase</li>
<li>The RBA surcharge framework indicates merchants should review the level of any surcharge applied at least once a year</li>
<li>Any refund of a purchase with surcharge applied needs to include the full purchase + surcharge amount</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="error-handling">Error handling<a class="hash-link" aria-label="Direct link to Error handling" title="Direct link to Error handling" href="/fusion/docs/getting-started#error-handling">​</a></h3>
<p>When the Sale System sends a request, it will receive a matching response. For example, if the Sale System sends a <a href="/fusion/docs/api-reference/fusion-cloud#payment">payment request</a>, it will receive a <a href="/fusion/docs/api-reference/fusion-cloud#payment-response">payment response</a>.</p>
<p>However, in unusual scenarios wherein the Sale System sends a request but doesn&#x27;t receive a corresponding response (for example, due to network error or timeout), the Sale System must enter an error handling loop.</p>
<p>More information about how to handle such scenario can be found in the <a href="/fusion/docs/api-reference/fusion-cloud#error-handling">Error handling section of the Cloud API</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fuel-api">Fuel API<a class="hash-link" aria-label="Direct link to Fuel API" title="Direct link to Fuel API" href="/fusion/docs/getting-started#fuel-api">​</a></h3>
<p>The Fusion Fuel API is an extension to the Fusion Core API which adds support for current and future fuel payment types accepted by DataMesh. (e.g. FleetCard, Shell Card, MotorPass etc)</p>
<p>For more information see the <a href="/fusion/docs/api-reference/fusion-api-fuel-extension">Fusion API Fuel Extension</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stored-value-api">Stored Value API<a class="hash-link" aria-label="Direct link to Stored Value API" title="Direct link to Stored Value API" href="/fusion/docs/getting-started#stored-value-api">​</a></h3>
<p>The Fusion Stored Value API is an extension to the Fusion Core API which adds support for gift card payments.</p>
<p>For more information see the <a href="/fusion/docs/api-reference/fusion-api-stored-value-extension">Fusion API Stored Value Extension</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="product-level-blocking-plb">Product level blocking (PLB)<a class="hash-link" aria-label="Direct link to Product level blocking (PLB)" title="Direct link to Product level blocking (PLB)" href="/fusion/docs/getting-started#product-level-blocking-plb">​</a></h3>
<p>PLB is a program that automatically prevents enhanced income management cards from being used to purchase restricted items (alcohol, gambling services, tobacco products, cash-like products etc).</p>
<p>PLB transaction example:</p>
<ol>
<li>When constructing a <a href="/fusion/docs/api-reference/data-model#payment-request">Payment Request</a>, the Sale System sets the <a href="/fusion/docs/api-reference/data-model#saleitem">PaymentRequest.PaymentTransaction.SaleItem[].Restricted</a> flag to <code>true</code> for each sale item classified as &quot;restricted&quot; under the PLB scheme.</li>
<li>The cardholder presents their card on the POI Terminal.</li>
<li>If the card presented is an enhanced income management card, and either the  Sale System has flagged sale items as <code>Restricted</code>, or no sale items were provided in the request, then the POI terminal declines the sale</li>
<li>PaymentResponse.AllowedProductCodes contains the <code>SaleItem.ProductCode</code> of items which were blocked</li>
<li><a href="/fusion/docs/api-reference/data-model#result">PaymentResponse.Response.Result</a> will be set to <code>Failure</code></li>
<li><a href="/fusion/docs/api-reference/data-model#errorcondition">PaymentResponse.Response.ErrorCondition</a> will be set to <code>PaymentRestriction</code></li>
<li><a href="/fusion/docs/api-reference/data-model#additionalresponse">PaymentResponse.Response.AdditionalResponse</a> will contain &quot;Restricted items&quot; if the payment was declined due to restricted items, or &quot;No Product Data&quot; if the payment was declined due to no <code>SaleItem</code> data provided.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restricted-payment-brands">Restricted payment brands<a class="hash-link" aria-label="Direct link to Restricted payment brands" title="Direct link to Restricted payment brands" href="/fusion/docs/getting-started#restricted-payment-brands">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This feature is only available to select merchants. Please discussion with the <a href="mailto:integrations@datameshgroup.com" target="_blank" rel="noopener noreferrer">integrations team</a> before implementing.</p></div></div>
<p>The Sale System can restrict the payment request to specified payment brands by configuring <a href="/fusion/docs/api-reference/data-model#allowedpaymentbrand">PaymentRequest.PaymentTransaction.TransactionConditions.AllowedPaymentBrand</a>.</p>
<p>This can be used by the Sale System to implement business rules for restricted payment types per transaction. e.g. preventing the purchase of a gift card with another gift card, or preventing the use of loyalty cards when discounts have been provided.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="payment-request">Payment request<a class="hash-link" aria-label="Direct link to Payment request" title="Direct link to Payment request" href="/fusion/docs/getting-started#payment-request">​</a></h4>
<p>The Sale System can configure the restricted payment brands behaviour in several ways:</p>
<ul>
<li>Allowing all payment brands</li>
<li>Specify allowed payment brands</li>
<li>Specify allowed payment brand categories</li>
<li>Specify allowed payment brands</li>
<li>Specify allowed payment brand categories</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Where possible, the Sale System should specify payment brand <strong>categories</strong> instead of specific payment brands. This will ensure the expected behaviour continues once payment brands are added in the future.</p></div></div>
<p><strong>Allowing all payment brands</strong></p>
<p>The default behaviour by the POI Terminal is to accept all payment brands when <a href="/fusion/docs/api-reference/data-model#allowedpaymentbrand">AllowedPaymentBrand</a> is null or empty.</p>
<p><em>Example - allow all payment brands</em></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Specify allowed payment brands</strong></p>
<p>To specify which payment brands to allow, add the supported <a href="/fusion/docs/api-reference/data-model#paymentbrandid">PaymentBrandId</a> to <a href="/fusion/docs/api-reference/data-model#allowedpaymentbrand">AllowedPaymentBrands</a>.</p>
<p>When an allowed payment brand is specified, all other payment brands are blocked.</p>
<p><em>Example - block all payment brands except VISA Debit and VISA Credit</em></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: [ &quot;0004&quot;, &quot;0005&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Specify allowed payment brand categories</strong></p>
<p>To specify which payment brand categories to allow, prefix <code>Category:</code> to a supported <a href="/fusion/docs/api-reference/data-model#paymentbrandid">PaymentBrandId</a> category in <a href="/fusion/docs/api-reference/data-model#allowedpaymentbrand">AllowedPaymentBrand</a>.</p>
<p>When an allowed payment brand category is specified, all other payment brands outside the category are blocked.</p>
<p><em>Example - block all payment brands except card schemes</em></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: [ &quot;Category:Schemes&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Specify restricted payment brands</strong></p>
<p>To specify which payment brands to restrict, prefix a <code>!</code> to the restricted <a href="/fusion/docs/api-reference/data-model#paymentbrandid">PaymentBrandId</a> in <a href="/fusion/docs/api-reference/data-model#allowedpaymentbrand">AllowedPaymentBrand</a>.</p>
<p>When a restricted payment brand is specified, all other payment brands are allowed.</p>
<p><em>Example - allow all payment brands except EFTPOS &amp; Blackhawk</em></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: [ &quot;!0001&quot;, &quot;!0600&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Specify restricted payment brand categories</strong></p>
<p>To specify which payment brand categories to restrict, prefix a <code>!Category:</code> to the restricted <a href="/fusion/docs/api-reference/data-model#paymentbrandid">PaymentBrandId</a> category in <a href="/fusion/docs/api-reference/data-model#allowedpaymentbrand">AllowedPaymentBrand</a>.</p>
<p>When a restricted payment brand category is specified, all other payment brands outside the category are blocked.</p>
<p><em>Example - allow all payment brands except gift cards and fuel cards</em></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: [ &quot;!Category:GiftCard&quot;, &quot;!Category:Fuel&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Mixing allowed and restricted payment brands and categories</strong></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The Sale System should take care when mixing allowed and restricted payment brands and categories</p></div></div>
<p>Specifying a restricted payment brand category as well as a restricted payment brand is supported.</p>
<p>*Example - allow all payment brands except fuel cards, gift cards, and Flybuys.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: [ &quot;!Category:Fuel&quot;, &quot;!Category:GiftCard&quot;, &quot;!0402&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Mixing allowed and restricted payment brands and categories is not recommended as it can lead to unexpected behaviour.</p>
<p><em>Example - block all payment brands except fuel cards. The <code>!0001</code> entry will have no effect</em></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;PaymentRequest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PaymentTransaction&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TransactionConditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;AllowedPaymentBrand&quot;: [ &quot;!0001&quot;, &quot;Category:Fuel&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="payment-response">Payment response<a class="hash-link" aria-label="Direct link to Payment response" title="Direct link to Payment response" href="/fusion/docs/getting-started#payment-response">​</a></h4>
<p>If the cardholder presents a restricted payment brand, the POI Terminal will decline the payment request with the payment response set to:</p>
<ul>
<li><a href="/fusion/docs/api-reference/data-model#result">PaymentResponse.Response.Result</a> will be set to <code>Failure</code></li>
<li><a href="/fusion/docs/api-reference/data-model#errorcondition">PaymentResponse.Response.ErrorCondition</a> will be set to <code>PaymentRestriction</code></li>
<li><a href="/fusion/docs/api-reference/data-model#additionalresponse">PaymentResponse.Response.AdditionalResponse</a> will contain &quot;Restricted payment brand&quot;</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--next" href="/fusion/docs/category/api-reference"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">API Reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#create-a-test-account">Create a test account</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#determine-your-integration-type">Determine your integration type</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-app">Fusion App</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-app-payment-lifecycle-events-mode">Fusion App payment lifecycle (events mode)</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-app-payment-lifecycle-blocking-mode">Fusion App payment lifecycle (blocking mode)</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-satellite">Fusion Satellite</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-satellite-payment-lifecycle">Fusion Satellite payment lifecycle</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-cloud">Fusion Cloud</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fusion-cloud-payment-lifecycle">Fusion Cloud payment lifecycle</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#mandatory-features-checklist">Mandatory features checklist</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#design-your-integration">Design your integration</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#sale-system-settings">Sale System settings</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#static-sale-system-settings">Static Sale System settings</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#cashier-configurable-settings">Cashier configurable settings</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#qr-code-pairing">QR code pairing</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#payment-types">Payment types</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#payment-identification">Payment identification</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#sale--payment-identification">Sale &amp; payment identification</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#requestresponse-identification">Request/response identification</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#receipt-printing">Receipt printing</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#payment-user-interface">Payment user interface</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#initial-ui">Initial UI</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#display-ui">Display UI</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#input-ui">Input UI</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#final-ui">Final UI</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#cancelling-a-sale-in-progress">Cancelling a sale in progress</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#product-data">Product data</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#refunds">Refunds</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#matched-refund">Matched refund</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#unmatched-refund">Unmatched refund</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#cash-out">Cash out</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#cash-out-on-sale-system">Cash out on Sale System</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#pre-auth--completion">Pre-auth / completion</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#pre-authorisation">Pre-authorisation</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#completion">Completion</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#settlement">Settlement</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#tokenisation">Tokenisation</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#tokenise-a-card-used-for-a-payment">Tokenise a card used for a payment</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#tokenise-a-card-without-payment">Tokenise a card without payment</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#partial-payments">Partial payments</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#split-payments">Split payments</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#tipping">Tipping</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#tip-on-sale-system">Tip on Sale System</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#tip-on-poi-terminal">Tip on POI Terminal</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#dynamic-surcharge">Dynamic surcharge</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#merchant-responsibilities">Merchant responsibilities</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#error-handling">Error handling</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#fuel-api">Fuel API</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#stored-value-api">Stored Value API</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#product-level-blocking-plb">Product level blocking (PLB)</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#restricted-payment-brands">Restricted payment brands</a><ul><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#payment-request">Payment request</a></li><li><a class="table-of-contents__link toc-highlight" href="/fusion/docs/getting-started#payment-response">Payment response</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">2024-09-03</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Useful Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.datameshgroup.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DataMesh Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/datameshgroup" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:integrations@datameshgroup.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DataMesh<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 <a href="https://www.datameshgroup.com/">DataMesh Group</a>.</div></div></div></footer></div>
</body>
</html>